<script>
// =========================================================
// CAUGIA GTM INTELLIGENCE REPORT â€” JS ENGINE v1.0
// Init â€¢ Pillar Linking â€¢ Question Rendering
// =========================================================

// ---------------------------
// 1. Collect DOM Elements
// ---------------------------
const questions = Array.from(document.querySelectorAll('.gi-question'));
const pillarTitle = document.getElementById('gi-pillar-title');
const pillarMeta  = document.getElementById('gi-pillar-meta');
const pillarLabel = document.getElementById('gi-pillar-step');
const sidebarPillars = Array.from(document.querySelectorAll('.gi-side-pillar-list li'));

let currentIndex = 0;
const totalQuestions = questions.length;

// Define how many questions belong to each pillar
// (You will update this when all pillars & all questions are added)
const pillarStructure = [
  { start: 0, end: 4,  title: "Context Capture", meta: "Capturing essential background about goals, growth stage and constraints." },
  { start: 5, end: 29, title: "Market Intelligence", meta: "How well your organization reads markets, competitors and signals." },
  // ... add other pillars here ...
];


// ---------------------------
// 2. Hide all questions
// ---------------------------
function hideAllQuestions() {
  questions.forEach(q => q.style.display = "none");
}


// ---------------------------
// 3. Render Current Question
// ---------------------------
function renderQuestion(index) {
  hideAllQuestions();
  const q = questions[index];
  if (!q) return;

  q.style.display = "block";

  updatePillarForIndex(index);
  updateSidebarPillar(index);
  updateProgress(index);
}


// ---------------------------
// 4. Determine active pillar
// ---------------------------
function updatePillarForIndex(index) {
  let pillar = pillarStructure.find(p => index >= p.start && index <= p.end);
  if (!pillar) return;

  pillarTitle.textContent = pillar.title;
  pillarMeta.textContent  = pillar.meta;

  const pillarNumber = pillarStructure.indexOf(pillar) + 1;
  const totalPillars = pillarStructure.length;

  pillarLabel.textContent = `Pillar ${pillarNumber} of ${totalPillars}`;
}


// ---------------------------
// 5. Sidebar pillar highlight
// ---------------------------
function updateSidebarPillar(index) {
  sidebarPillars.forEach(li => li.classList.remove('is-active'));

  let pillar = pillarStructure.find(p => index >= p.start && index <= p.end);
  if (!pillar) return;

  const pillarIndex = pillarStructure.indexOf(pillar);
  sidebarPillars[pillarIndex].classList.add('is-active');
}


// ---------------------------
// 6. Progress Update
// ---------------------------
function updateProgress(index) {
  const bar = document.getElementById('gi-progress-bar');
  const count = document.getElementById('gi-progress-count');
  const percent = document.getElementById('gi-progress-percent');

  const completed = index + 1;
  const percentage = Math.round((completed / totalQuestions) * 100);

  count.textContent = `${completed} of ${totalQuestions}`;
  percent.textContent = `${percentage}%`;

  bar.style.width = `${percentage}%`;
}


// ---------------------------
// 7. Initialize Page
// ---------------------------
function initAssessment() {
  hideAllQuestions();
  renderQuestion(0);
}

initAssessment();

</script>
